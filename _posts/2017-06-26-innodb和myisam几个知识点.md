# MyISAM和InnoDB
date: 2017-06-26 16:28:09

title: MyISAM和InnoDB几个知识点
categories: 数据库
tags:
  - InnoDB
  - MyISAM
---
说说MySQL两个最常用的存储引擎，MyISAM和InnoDB。
### 一、关于count(*)
```
MyISAM会直接存储总行数，InnoDB则不会，需要按行扫描。
```
对于select count(*) from t; 如果数据量大，MyISAM会瞬间返回，而InnoDB则会一行行扫描。

但是，只有查询全表的总行数，MyISAM才会直接返回结果，当加了where条件后，两种存储引擎的处理方式类似。

### 二、关于全文索引

``` 
 MyISAM支持全文索引，InnoDB5.6之前不支持全文索引。
```


但是不管哪种存储引擎，在数据量大并发量大的情况下，都不应该使用数据库自带的全文索引，会导致小量请求占用大量数据库资源

### 三、关于事务
```
 MyISAM不支持事务，InnoDB支持事务。  
```
InnoDB提供事务，事务提供了commit，rollback，崩溃修复等能力。在系统异常崩溃时，MyISAM有一定几率造成文件损坏，这是非常烦的。但是，事务也非常耗性能，会影响吞吐量，建议只对一致性要求较高的业务使用复杂事务。

MyISAM可以通过lock table表锁，来实现类似于事务的东西，但对数据库性能影响较大，强烈不推荐使用。
### 四、关于外键
```
MyISAM不支持外键，InnoDB支持外键。
```
不管哪种存储引擎，在数据量大并发量大的情况下，都不应该使用外键，而建议由应用程序保证完整性。

### 五、关于行锁与表锁
```
MyISAM只支持表锁，InnoDB可以支持行锁。
```
因为：
MyISAM：执行读写SQL语句时，会对**表加锁**，所以数据量大，并发量高时，性能会急剧下降。
InnoDB：细粒度**行锁**，在数据量大，并发量高时，性能比较优异。

网上资料说，select+insert的业务用MyISAM，因为MyISAM在文件尾部顺序增加记录速度极快。我觉得绝大部分业务是混合读写，只要数据量和并发量较大，一律使用InnoDB。


InnoDB的行锁是实现在索引上的，而不是锁在物理行记录上。也就是说，***如果访问没有命中索引，也无法使用行锁，将要退化为表锁***。






